<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="registrationstyle.css" />
  <link rel="stylesheet" href="booktablestyle.css" />
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>

  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registration</title>
</head>

<body>
  <header class="w3-container w3-teal">
    <h1>Working Talent</h1>
  </header>


  <form action="action_page.php">
    <div class="registration-container">
      <h1>Register</h1>
      <p>Please fill in this form to create an account.</p>
      <hr />

      <label for="psw"><b>Password</b></label>
      <input type="password" placeholder="Enter Password" name="psw" id="psw" required />

      <label for="psw-repeat"><b>Repeat Password</b></label>
      <input type="password" placeholder="Repeat Password" name="psw-repeat" id="psw-repeat" required />
      <hr />

      <p>
        By creating an account you agree to our
        <a href="#">Terms & Privacy</a>.
      </p>
      <button type="button" onclick="passwordValidation()" class="registerbtn">
        Confirm Registration
      </button>
    </div>
  </form>
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <footer class="w3-container w3-teal">
    <h5>Footer</h5>
    <p>Footer information goes here</p>
  </footer>
</body>
<script>
  function passwordValidation() {
    let password = document.getElementById("psw").value;
    let pswRepeat = document.getElementById("psw-repeat").value;

    if (password === pswRepeat) {
      changePasswordAndSetActive();
    } else {
      alert("Passwords don't match");
    }
  }

  function changePasswordAndSetActive() {

    let password = document.getElementById("psw-repeat").value;

    let newInfo = {
      password: password,
    }

    fetch('http://localhost:8080/user/register', {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        Authorization: localStorage.getItem("token"),
      }, 
      body: JSON.stringify(newInfo),
    })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          window.location.href = 'showbooks.html';
        }
        alert("Password has been changed");
        //console.log(this.responseText);
      })

      //window.location.href = 'showbooks.html';
  }

  document.getElementById('psw-repeat').onkeydown = function (event) {
      if (event.keyCode == 13) {
        passwordValidation();
      }
    }
</script>

</html>