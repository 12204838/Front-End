<!DOCTYPE html>
<html lang="en">
<head class="flex-container">
    <link rel="stylesheet" href="bookcopystyle.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book table</title>
</head>

<body>
 <header class="w3-container w3-teal">
  <h1>
    Working Talent Copy Table
  </h1>
 </header>
  <div class = "container" id="allBookCopiesTable" ></div>
  
  
  <div class = "flex-container">
    <div class = "container">
      <label for="bookid">Book ID</label>
      <input  id="bookid" type="text">
      <br>
      <label for="bookName">Title</label>
      <input type="text" id="bookName">
      <br>
      <label for="authorName">author</label>
      <input id="authorName" type="text">
      <br>
      <label for="quantity">ISBN</label>
      <input type="text" id="quantity">
      <br>
    </div>
    
    <div class = "container">
      <button class= "add-book-button button"type="button" onclick="addBook()">add book</button>
      <br>
      <button class= "update-book-button button" type = "button" onclick = "updateBook()">edit book</button>
      <br>
      <button class= "delete-book-button button" type = "button" onclick = "deleteBook()">delete book</button>
    </div>
  </div>

  <footer class="w3-container w3-teal">
    <h5>Footer</h5>
    <p>Footer information goes here</p>
  </footer>
  </body>




  <script >
      function showAllBookCopies(){
          var xhr = new XMLHttpRequest();
          xhr.onreadystatechange = function(){
                  console.log(this.responseText);
                  var allBookCopies = JSON.parse(this.responseText);
                  var eindstring =`<table class ="styled-table">
                                              <thead>
                                                  <tr>
                                                      <th>ID</th>
                                                      <th>Book ID</th>
                                                  </tr>
                                          </thead>`;
                      for (x=0; x<allBookCopies.length; x++){
                          eindstring +=`
                                      <tr>    
                                          <td>${allBookCopies[x].id}</td>
                                          <td>${allBookCopies[x].bookId}</td> 
                                                     
                                      </tr>`;
                      }
                      eindstring += "</table>";
                      document.getElementById("allBookCopiesTable").innerHTML = eindstring;
              //console.log(this.responseText);
          }
          
          xhr.open("GET", "http://localhost:8080/bookcopies",true);
          xhr.send();
      }
  
      function addBook() {
          // Formulier uitlezen
          let bookIdInvoer = document.getElementById("bookid").value;
          let bookNameInvoer = document.getElementById("bookName").value;
          let authorNameInvoer = document.getElementById("authorName").value;
          let ISBNInvoer = document.getElementById("quantity").value;
  
          // Javascript object
          let newBook = {
            id: bookIdInvoer,
            title: bookNameInvoer,
            author: authorNameInvoer,
            isbn: ISBNInvoer,
          };
  
          // Fetch call
          fetch("http://localhost:8080/book/save", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newBook),
          })
            .then((res) => {
              showAllBooks();
              alert("Is goedgegaan");
            })
            .catch((error) => {
              alert("Er is iets fouts gegaan");
            });
        }
  
  
        function updateBook() {
          // Formulier uitlezen
          let bookIdInvoer = document.getElementById("bookid").value;
          let bookNameInvoer = document.getElementById("bookName").value;
          let authorNameInvoer = document.getElementById("authorName").value;
          let ISBNInvoer = document.getElementById("quantity").value;
          // Javascript object
          let newInfo = {
            id: bookIdInvoer,
            title: bookNameInvoer,
            author: authorNameInvoer,
            isbn: ISBNInvoer,
          };
  
          // Fetch call
          fetch(`http://localhost:8080/book/update/${bookIdInvoer}`, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newInfo),
          })
            .then((res) => {
                
              alert("Is goedgegaan");
              showAllBooks();
            })
            .catch((error) => {
              alert("Er is iets fouts gegaan");
            });
        }
  
        function deleteBook() {
          // Formulier uitlezen
          let bookIdInvoer = document.getElementById("bookid").value;
          // Javascript object
          let delInfo = {
            id: bookIdInvoer,
          };
  
          // Fetch call
          fetch(`http://localhost:8080/book/delete/${bookIdInvoer}`, {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(delInfo),
          })
            .then((res) => {
                
              alert("Is goedgegaan");
              showAllBooks();
            })
            .catch((error) => {
              alert("Er is iets fouts gegaan");
            });
            
        }
        showAllBookCopies();
  
  </script>
</html>