<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="booktablestyle.css">
    <link rel="stylesheet" href="switch.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <header class="w3-container w3-teal">
        <h1>Working Talent</h1>
    </header>
    
    <div class="topnav">
        <a class="" href="booktable.html">Book table</a>
        <a class="" href="bookcopy.html">Copy table</a>
        <a class="" href="Userstable.html">Users table</a>
        <a class="active" href="reservation.html"> Reservation table</a>
    </div>

    
    <div class = "container">    
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Reservation ID</th>
                    <th>Book title</th>
                    <th>Employee</th>
                    <th>Approved</th>
                    <th>Approve?</th>
                    <th>Delete?</th>
                </tr>
            </thead>
            
            <tbody id="reservations-data">
                
            </tbody>
        </table>
    </div>
    
    <div class = "flex-container">
        <div class = "container">
            <input type="number" id="id" placeholder = "reservation ID">
            <input type="number" id="bookId" placeholder = "Book ID">
            <input type="number" id="userId" placeholder = "User ID">
            Approved
            <label class="switch">
                <input type="checkbox" id="approved">
                <span class="slider round"></span>  
            </label>
        </div>
        
        <div class = "container">
            <button class ="add-book-button button" type="button" onclick = "addReservation()">add reservation</button>
        </div>
    </div>
</body>

<script>
function deleteReservation(reservationId){
    let idInput = reservationId;

    // Delete
    fetch(`http://localhost:8080/reservation/delete/${idInput}`,{
    method: "DELETE",
    })
    .then((res) => {
            showReservations();
        });
}

function approveReservation(reservationId){
        //formulier uitlezen
        let idInput = reservationId;
        let isApprovedInput = true;

        // Javascript object
        let newReservation = {
            approved: isApprovedInput,
        };

        // Fetch call
        fetch(`http://localhost:8080/reservation/updatebybookidanduserid/${idInput}`,{
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(newReservation),
        })
        .then((res) => {
            showReservations();
        });
    }


    function addReservation(){
        //formulier uitlezen
        let bookIdInput = document.getElementById("bookId").value;
        let userIdInput = document.getElementById("userId").value;
        let isApproved = document.getElementById("approved").checked;

        // Javascript object
        let newReservation = {
            bookId: bookIdInput,
            userId: userIdInput,
            approved: isApproved,
        };

        // Fetch call
        fetch('http://localhost:8080/reservation/savebybookanduserid',{
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(newReservation),
        })
        .then((res) => {
            showReservations();
        });
    }

/**
* This method displays all reservations from the reservations table.
*/
function showReservations(){
        fetch('http://localhost:8080/reservations')
        .then(res => res.json())
        .then(data =>{
            let reservationsHtml = '';
            data.forEach(reservation => {
                reservationsHtml += `
                <tr>
                    <td>${reservation.id}</td>
                    <td>${reservation.bookTitle}</td>
                    <td>${reservation.nameEmployee}</td>
                    <td>${reservation.approved}</td>
                    <td><button class ="add-book-button button" type="button" onclick="approveReservation(${reservation.id})">Approve</button></td>
                    <td><button class ="add-book-button button" type="button" onclick ="deleteReservation(${reservation.id})">Delete</button></td>
                </tr>
                `
            });
            document.getElementById('reservations-data').innerHTML = reservationsHtml
        })
  }
    showReservations();
</script>
</html>