<!DOCTYPE html>
<html lang="en">
<head class="flex-container">
    <link rel="stylesheet" href="booktablestyle.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book table</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

</head>

<body>

 <header class="w3-container w3-teal">
  
  <h1>
    Working Talent
  </h1>

 </header>

 <div class="topnav">
  <a class="active" >Book table</a>
  <a class="" href="bookcopy.html">Copy table</a>
  <a class="" href="userstable.html"> User Table</a>
  <a class="" href="reservation.html"> Reservation Table</a>
  <a class="" href="borrowedcopy.html"> Borrowedcopy Table</a>
</div>
  <div class = "container" >
    <table class = "table styled-table">
      <thead>
          <tr>
              <th>ID</th>
              <th>Title</th>
              <th>Author</th>
              <th>Isbn</th>
              <th>Add copy</th>
          </tr>
      </thead>
      <tbody id="allBooksTable">
          

      </tbody>
  </table>
  </div>
  
  
  <div class = "flex-container">
    <div class = "container">
      <label for="bookid">Book ID</label>
      <input  id="bookid" type="text">
      <br>
      <label for="bookName">Title</label>
      <input type="text" id="bookName">
      <br>
      <label for="authorName">author</label>
      <input id="authorName" type="text">
      <br>
      <label for="quantity">ISBN</label>
      <input type="text" id="quantity">
      <br>
    </div>
    
    <div class = "container">
      <button class= "add-book-button button"type="button" onclick="addBook()">add book</button>
      <br>
      <button class= "update-book-button button" type = "button" onclick = "updateBook()">edit book</button>
      <br>
      <button class= "delete-book-button button" type = "button" onclick = "deleteBook()">delete book</button>
    </div>
  </div>

  <footer class="w3-container w3-teal">
    <h5>Footer</h5>
    <p>Footer information goes here</p>
  </footer>
  </body>




  <script >

    /**
	   * This shows all books in the book repository and fills booktable with content.
	  */
      function showAllBooks(){
        fetch('http://localhost:8080/books')
        .then(res => res.json())
        .then(data =>{
            console.log('het is gelukt');
            
            console.log(data);

            let booksHtml = '';
            data.forEach(book => {
                booksHtml += `
                                      <tr > 
                                          <td >${book.id}</td>
                                          <td >${book.title}</td> 
                                              <td>${book.author}</td>
                                              <td>${book.isbn}</td>     
                                              <td><button type= "button" onclick = "addBookCopies2(${book.id})" class="editbtn">add</button></td>  
                                      </tr>`; 

                      });

                      document.getElementById("allBooksTable").innerHTML = booksHtml;
              //console.log(this.responseText);
          })
       }

      /**
       * This method gets information of a book object and saves in the book repository.
       * 
       * @param Book Object that contains the bookId, author, title, isbn, amount of bookcopies.
       */
      function addBook() {
          // Formulier uitlezen
          let bookIdInvoer = document.getElementById("bookid").value;
          let bookNameInvoer = document.getElementById("bookName").value;
          let authorNameInvoer = document.getElementById("authorName").value;
          let ISBNInvoer = document.getElementById("quantity").value;
  
          // Javascript object
          let newBook = {
            id: bookIdInvoer,
            title: bookNameInvoer,
            author: authorNameInvoer,
            isbn: ISBNInvoer,
          };
  
          // Fetch call
          fetch("http://localhost:8080/book/save", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newBook),
          })
            .then((res) => {
              showAllBooks();
              alert("Is goedgegaan");
            })
            .catch((error) => {
              alert("Er is iets fouts gegaan");
            });
        }

         /**
        * This method gets information from text and saves this variable: amount.
         * 
         * @return returns a variable amount 
         */
        function addBookCopiesPrompt() {
          let text;
          let amount = prompt("Please enter the amount:", "0");
          if (amount == null || amount == "") {
            text = "User cancelled the prompt.";
          } else {
            return amount
          }
  
        }   

        /**
        * This method saves an bookcopy in the bookcopy table by book id.
        * it thas this by the amount of times receiven from AddBookCopiesPrompt
        * 
        * @param Book ID received from the booktable
        */
        function addBookCopies2(x){ 

          amountInvoer = addBookCopiesPrompt()        
         // Formulier uitlezen
          let bookIdInvoer = x;
          console.log(bookIdInvoer)
          // Javascript object
          let newBook = {
            bookId: bookIdInvoer,
          };

          amountInvoer = Number(amountInvoer);
  
          // Fetch call
          for (y=0; y<amountInvoer; y++){
            fetch("http://localhost:8080/bookcopy/savebybookid", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newBook),
          })
            .then((res) => {
              showAllBooks();
              alert("Is goedgegaan");
            })
            .catch((error) => {
              alert("Er is iets fouts gegaan");
            });
          }

        }
        

        /**
        * This method updates a book in the book repository based on information from the 
        * front-end inpunt fields.
        */
        function updateBook() {
          // Formulier uitlezen
          let bookIdInvoer = document.getElementById("bookid").value;
          let bookNameInvoer = document.getElementById("bookName").value;
          let authorNameInvoer = document.getElementById("authorName").value;
          let ISBNInvoer = document.getElementById("quantity").value;
          // Javascript object
          let newInfo = {
            id: bookIdInvoer,
            title: bookNameInvoer,
            author: authorNameInvoer,
            isbn: ISBNInvoer,
          };
  
          // Fetch call
          fetch(`http://localhost:8080/book/update/${bookIdInvoer}`, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newInfo),
          })
            .then((res) => {
                
              alert("Is goedgegaan");
              showAllBooks();
            })
            .catch((error) => {
              alert("Er is iets fouts gegaan");
            });
        }
        
        /**
        * This method deletes a book from the book repository based on information from the 
        * front-end inpunt fields.
        */
        function deleteBook() {
          // Formulier uitlezen
          let bookIdInvoer = document.getElementById("bookid").value;
          // Javascript object
          let delInfo = {
            id: bookIdInvoer,
          };
  
          // Fetch call
          fetch(`http://localhost:8080/book/delete/${bookIdInvoer}`, {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(delInfo),
          })
            .then((res) => {
                
              alert("Is goedgegaan");
              showAllBooks();
            })
            .catch((error) => {
              alert("Er is iets fouts gegaan");
            });
            
        }
        showAllBooks();
  
  </script>
</html>