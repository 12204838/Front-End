<!DOCTYPE html>
<html lang="en">
<head class="flex-container">
    <link rel="stylesheet" href="booktablestyle.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book table</title>
</head>

<body>

 <header class="w3-container w3-teal">
  
  <h1>
    Working Talent Book Table
  </h1>

 </header>

 <div class="topnav">
  <a class="active" href="bookcopy.html">Copy table</a>
  <a class="active" href="UsersTable.html"> User Table</a>
</div>
  <div class = "container" id="allBooksTable" ></div>
  
  
  <div class = "flex-container">
    <div class = "container">
      <label for="bookid">Book ID</label>
      <input  id="bookid" type="text">
      <br>
      <label for="bookName">Title</label>
      <input type="text" id="bookName">
      <br>
      <label for="authorName">author</label>
      <input id="authorName" type="text">
      <br>
      <label for="quantity">ISBN</label>
      <input type="text" id="quantity">
      <br>
    </div>
    
    <div class = "container">
      <button class= "add-book-button button"type="button" onclick="addBook()">add book</button>
      <br>
      <button class= "update-book-button button" type = "button" onclick = "updateBook()">edit book</button>
      <br>
      <button class= "delete-book-button button" type = "button" onclick = "deleteBook()">delete book</button>
    </div>
  </div>

  <footer class="w3-container w3-teal">
    <h5>Footer</h5>
    <p>Footer information goes here</p>
  </footer>
  </body>




  <script >
      function showAllBooks(){
          var xhr = new XMLHttpRequest();
          xhr.onreadystatechange = function(){
                  console.log(this.responseText);
                  var allBooks = JSON.parse(this.responseText);
                  var eindstring =`<table id = "booktable" class ="styled-table">
                                              <thead>
                                                  <tr>
                                                      <th>ID</th>
                                                      <th>Title</th>
                                                      <th>Author Name</th>
                                                      <th>ISBN</th>
                                                      <th>Add Book</th>
                                                  </tr>
                                          </thead>`;
                      for (x=0; x<allBooks.length; x++){
                          eindstring +=`
                                      <tr > 
                                          <td id=${x}>${allBooks[x].id}</td>
                                          <td >${allBooks[x].title}</td> 
                                              <td>${allBooks[x].author}</td>
                                              <td>${allBooks[x].isbn}</td>     
                                              <td><button type= "button" onclick = "addBookCopies2(${x})" class="editbtn">add</button></td>  
                                      </tr>`; 

                      }
                      eindstring += "</table>";
                      document.getElementById("allBooksTable").innerHTML = eindstring;
              //console.log(this.responseText);
          }
          
          xhr.open("GET", "http://localhost:8080/books",true);
          xhr.send();
      }
  
      function addBook() {
          // Formulier uitlezen
          let bookIdInvoer = document.getElementById("bookid").value;
          let bookNameInvoer = document.getElementById("bookName").value;
          let authorNameInvoer = document.getElementById("authorName").value;
          let ISBNInvoer = document.getElementById("quantity").value;
  
          // Javascript object
          let newBook = {
            id: bookIdInvoer,
            title: bookNameInvoer,
            author: authorNameInvoer,
            isbn: ISBNInvoer,
          };
  
          // Fetch call
          fetch("http://localhost:8080/book/save", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newBook),
          })
            .then((res) => {
              showAllBooks();
              alert("Is goedgegaan");
            })
            .catch((error) => {
              alert("Er is iets fouts gegaan");
            });
        }

        function addBookCopiesPrompt() {
  let text;
  let amount = prompt("Please enter the amount:", "0");
  if (amount == null || amount == "") {
    text = "User cancelled the prompt.";
  } else {
    return amount
  }
  
}
        function addBookCopies2(x){ 

          amountInvoer = addBookCopiesPrompt()        
         // Formulier uitlezen
          let bookIdInvoer = document.getElementById(x).innerHTML;
          console.log(bookIdInvoer)
          // Javascript object
          let newBook = {
            bookId: bookIdInvoer,
          };

          amountInvoer = Number(amountInvoer);
  
          // Fetch call
          for (y=0; y<amountInvoer; y++){
            fetch("http://localhost:8080/bookcopy/savebybookid", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newBook),
          })
            .then((res) => {
              showAllBooks();
              alert("Is goedgegaan");
            })
            .catch((error) => {
              alert("Er is iets fouts gegaan");
            });
          }

        }
          
       
  
        function updateBook() {
          // Formulier uitlezen
          let bookIdInvoer = document.getElementById("bookid").value;
          let bookNameInvoer = document.getElementById("bookName").value;
          let authorNameInvoer = document.getElementById("authorName").value;
          let ISBNInvoer = document.getElementById("quantity").value;
          // Javascript object
          let newInfo = {
            id: bookIdInvoer,
            title: bookNameInvoer,
            author: authorNameInvoer,
            isbn: ISBNInvoer,
          };
  
          // Fetch call
          fetch(`http://localhost:8080/book/update/${bookIdInvoer}`, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newInfo),
          })
            .then((res) => {
                
              alert("Is goedgegaan");
              showAllBooks();
            })
            .catch((error) => {
              alert("Er is iets fouts gegaan");
            });
        }
  
        function deleteBook() {
          // Formulier uitlezen
          let bookIdInvoer = document.getElementById("bookid").value;
          // Javascript object
          let delInfo = {
            id: bookIdInvoer,
          };
  
          // Fetch call
          fetch(`http://localhost:8080/book/delete/${bookIdInvoer}`, {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(delInfo),
          })
            .then((res) => {
                
              alert("Is goedgegaan");
              showAllBooks();
            })
            .catch((error) => {
              alert("Er is iets fouts gegaan");
            });
            
        }
        showAllBooks();
  
  </script>
</html>