<!DOCTYPE html>
<html lang="en">
  <head class="flex-container">
    <link rel="stylesheet" href="booktablestyle.css" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css" />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Borrowedcopy table</title>
  </head>
  <body>
    <header class="w3-container w3-teal">
      <h1>Working Talent</h1>
      <form align="right" name="form1" method="post" action="inlogapage.html">
        <label class="logoutLblPos">
        <input name="submit2" type="submit" id="submit2" value="log out" onclick = "localStorage.clear()">
        </label>
      </form>
    </header>

    <div class="navbarwt">
      <div class="dropdownwt">
      <button class="dropbtnwt">User
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-contentwt">
        <a  href="userportal.html">Userportal</a>
        <a  href="booktable.html">Book Table</a>
      </div>
    </div>
      <div class="dropdownwt">
        <button class="dropbtnwt">Admin
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-contentwt">
          <a  href="adminportal.html">Admin portal</a>
          <a  href="booktable.html">Book Table</a>
          <a  href="bookcopy.html">Copy Table</a>
          <a  href="userstable.html"> User Table</a>
          <a  href="reservation.html"> Reservation Table</a>
          <a  href="borrowedcopy.html"> Borrowedcopy Table</a>
        </div>
      </div>
    </div>
    <div class="container">
      <table class="table styled-table">
        <thead>
          <tr>
            <th>Lending History ID</th>
            <th>workingTalentId</th>
            <th>Startdate</th>
            <th>Enddate</th>
            <th>Userid</th>
            <th>Return Book</th>
          </tr>
        </thead>
        <tbody id="borrowedcopytable"></tbody>
      </table>
    </div>
    <footer class="w3-container w3-teal">
      <h5>Footer</h5>
      <p>Footer information goes here</p>
    </footer>
  </body>
  <script>
    /**
     * This method shows all borrowd copies in a table.
     */
    function showAllBorrowedCopies() {
      fetch("http://localhost:8080/borrowedcopies", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          Authorization: localStorage.getItem("token"),
        },
      })
        .then((res) => res.json())
        .then((data) => {
          let borrowedcopiesHtml = "";
          data.forEach((borrowedcopy) => {
            borrowedcopiesHtml += `
                                      <tr > 
                                          <td >${borrowedcopy.id}</td>
                                          <td >${borrowedcopy.bookId}.${borrowedcopy.wtId}</td> 
                                              <td>${borrowedcopy.startDate}</td>
                                              <td>${borrowedcopy.endDate}</td> 
                                              <td>${borrowedcopy.userId}</td> 
                                              <td><button type= "button" onclick = "returnBook(${borrowedcopy.id})" class="editbtn">return book</button></td>       
                                      </tr>`;
          });

          document.getElementById("borrowedcopytable").innerHTML =
            borrowedcopiesHtml;
          //console.log(this.responseText);
        });
    }

    /**
     * This method updates a borrowdcopy and adds an end date.
     */
    function returnBook(borrowedCopyId) {
      // Fetch call
      fetch(`http://localhost:8080/borrowedcopy/${borrowedCopyId}/return`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          Authorization: localStorage.getItem("token"),
        },
      })
        .then((res) => {
          showAllBorrowedCopies();
        })
        .catch((error) => {
          alert("Er is iets fouts gegaan");
        });
    }

    showAllBorrowedCopies();
  </script>
</html>
